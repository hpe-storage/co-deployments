{{ if $secret := (lookup "v1" "Secret" .Release.Namespace "nimble-secret") -}}
# This is required to maintain backward compatibility of resources(secret)
# created with previous releases as we no longer create a secret with CSI driver install.
# Annotation "helm.sh/resource-policy": keep" should help to remove this file altogether
# in future.
---
apiVersion: v1
kind: Secret
metadata:
  name: nimble-secret
  namespace: {{ .Release.Namespace }}
  annotations:
    "helm.sh/resource-policy": keep
stringData:
  username: {{ $secret.data.username }}
  password: {{ $secret.data.password }}
  servicePort: {{ $secret.data.servicePort }}
  backend: {{ $secret.data.backend }}
  serviceName: nimble-csp-svc
{{- end }}

{{ if $secret := (lookup "v1" "Secret" .Release.Namespace "primera3par-secret") -}}
---
apiVersion: v1
kind: Secret
metadata:
  name: primera3par-secret
  namespace: {{ .Release.Namespace }}
annotations:
  "helm.sh/resource-policy": keep
stringData:
  username: {{ $secret.data.username }}
  password: {{ $secret.data.password }}
  servicePort: {{ $secret.data.servicePort }}
  backend: {{ $secret.data.backend }}
  serviceName: primera3par-csp-svc
{{- end }}

